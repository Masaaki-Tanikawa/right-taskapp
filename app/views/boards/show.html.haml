.inner
  .board-back= link_to '＜ ボード一覧に戻る', root_path()
  .card-top
    .card-title
      %h2= @board.title
      %h3= @board.description
    - if user_signed_in? && current_user.boards.exists?(id: @board.id)
      .card-actions
        .card-icon
          = image_tag 'actions.svg', alt: 'Actions Icon'
          .dropdown-content.mini
            = link_to '編集する', edit_board_path(@board)
            = link_to '削除する', board_path(@board), data: { turbo_method: 'delete', turbo_confirm: '本当に削除してもよろしいですか？' }
    - else
      .board-author
        %p 管理者
        .board-image
          = image_tag @board.user.avatar_image
        .board-name= @board.user.display_name
    - next_direction = params[:direction] == 'asc' ? 'desc' : 'asc'
  .filter
    = form_with url: board_path(@board), method: :get, local: true, class: 'search-form' do
      .search-form
        = select_tag :sort,options_for_select([['タイトル', 'title'],['ステータス', 'status'],['締切', 'deadline'],['担当者', 'nickname']], params[:sort]),class: 'filter-box'
        - current_direction = params[:direction] || 'asc'
        - next_direction = params[:direction] == 'asc' ? 'desc' : 'asc'
        = hidden_field_tag :direction, next_direction
        = hidden_field_tag :q, params[:q]   # ← これが重要！
        - button_label = current_direction == 'asc' ? '並び替え ↓' : '並び替え ↑'
        = submit_tag button_label, class: 'filter-button'

    = form_with url: board_path(@board), method: :get, local: true, class: 'search-form' do
      = text_field_tag :q, params[:q], placeholder: "タイトルを入力", class: 'filter-box'
      .search-buttons
        = submit_tag "検索", class: 'filter-button'
        = link_to "リセット", board_path(@board), class: 'filter-button'
  .cards
    - @cards.each do |card|
      .cards-item
        = link_to board_card_path(@board, card), class: 'cards-link' do
          .cards-content-top
            .cards-title= card.title
          .cards-content-middle
            .cards-status
              %p= image_tag 'status.svg'
              %p= t("enums.card.status.#{card.status}")
            .cards-deadline
              %p= image_tag 'deadline.svg'
              %p= card.deadline
          .cards-description= card.description
          .cards-content-bottom
            .cards-author
              %p 担当者
              .cards-image
                = image_tag card.user.avatar_image
              .cards-name= card.user.display_name
            .cards-comment
              .cards-comment-number= card.comment_count
              .cards-comment-icon
                = image_tag 'comment.svg'

  - if user_signed_in?
    = link_to new_board_card_path(@board), class: 'create' do
      .create-content ＋ 新しいカードを追加